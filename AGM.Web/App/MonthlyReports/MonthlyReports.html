<div class="monthlyRep" ng-cloak>
    <h3 class="login-title login-control">Rapportini</h3>
    <div class="monthlyRep-users" ng-hide="detailVisible">
        <div class="container-fluid">
            <div class="col-xs-12 col-md-6 form-group">
                <input class="form-control" type="text" ng-model="search.name" placeholder="Ricerca..." />
            </div>
            <div ng-repeat="user in users | filter:search:false | orderBy:'name':false as usersFiltered">
                <div class="col-xs-12 nameListLetterHead" ng-show="showLetter($index)" ng-bind="getFirstChar(user.name)"></div>
                <div class="col-xs-12 col-md-3">
                    <button class="btn btn-default btn-block nameListElement" ng-click="showDetail(user.id)">
                        <img ng-src="{{user.picture}}" alt="" />
                        <div>
                            <span class="person-name" ng-bind="user.name"></span>
                            <span class="company-name" ng-bind="user.company"></span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div agm-footer></div>
    </div>
    <div class="monthlyRep-detail" ng-show="detailVisible">
        <a id="reportDetailTop"></a>
        <div>
            <i class="fa fa-arrow-circle-o-left sign" ng-click="backToUsers()"></i>&nbsp;<h4 class="detailUserName" ng-bind="detail.user.name"></h4>
        </div>
        <div class="col-xs-12 col-md-3 form-group">
            <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-calendar fa-fw"></i></span>
                <input id="monthPicker" type="text" class="form-control inputDatePicker" ng-model="selectedDate" ng-change="getUserDetail(selectedDate)"
                       data-min-view="1"
                       data-date-format="MMMM yyyy"
                       data-date-type="iso"
                       data-min-date="2014-01-01 00:00:00"
                       data-autoclose="1"
                       bs-datepicker
                       readonly>
            </div>
        </div>
        <div class="toolContainer"><i class="fa fa-plus-circle sign" ng-click="toggleAsideInsert()"></i></div>
        <div class="clearfix"></div>
        
        <div class="asideInsert" ng-show="showInsert">
            <div class="asideTitleContainer"><span class="asideTitle">Inserimento rapportino</span><i class="fa fa-times asideCloseIcon" ng-click="toggleAsideInsert()"></i></div>
            <div class="asideBodyContainer">
                <form name="asideInsert" novalidate>
                    <div class="col-xs-12 form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-calendar fa-fw"></i></span>
                            <input id="insertDayPicker" type="text" class="form-control inputDatePicker" ng-model="selectedInsertDate" ng-change="getUserDetail(selectedDate)"
                                   data-date-format="EEEE dd"
                                   data-date-type="iso"
                                   data-min-date="{{detail.minmonthdate}}"
                                   data-max-date="{{detail.maxmonthdate}}"
                                   data-autoclose="1"
                                   bs-datepicker
                                   readonly>
                        </div>
                    </div>
                    <div class="col-xs-12 form-group">
                        <div ng-class="{'has-error':!asideInsert.hour.$valid}">
                            <input name="hour" type="number" ng-model="insertHour" class="form-control" placeholder="Ore" min="0" max="24" step="any" />
                            <i ng-show="!asideInsert.hour.$valid" class="fa fa-exclamation-circle asideErrorInput" data-title="Il numero delle ore deve essere compreso tra 0 e 24" data-placement="right" data-trigger="click" bs-tooltip></i>
                        </div>
                        <button type="button" class="btn btn-default controlMinSeparated btnFill" ng-model="insertSelectedHourReason" ng-options="reason.id as reason.name for reason in detail.hourreasons" bs-select>
                            Action <span class="caret"></span>
                        </button>
                    </div>
                    <div class="col-xs-12 form-group">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span ng-show="insertSelectedExpenseReason == 1 || insertSelectedExpenseReason == 2">km</span>
                                <span ng-show="insertSelectedExpenseReason != 1 && insertSelectedExpenseReason != 2">€</span>
                            </span>
                            <input name="expense" type="number" ng-model="insertExpense" class="form-control" placeholder="Spese" min="0" max="9999" step="any" />
                        </div>
                        <i ng-show="!asideInsert.expense.$valid" class="fa fa-exclamation-circle asideErrorInput" data-title="Il numero deve essere compreso tra 0 e 9999" data-placement="right" data-trigger="click" bs-tooltip></i>
                        <button type="button" class="btn btn-default controlMinSeparated btnFill" ng-model="insertSelectedExpenseReason" data-html="1" ng-options="reason.id as reason.name for reason in detail.expensereasons" bs-select>
                            Action <span class="caret"></span>
                        </button>
                    </div>
                    <div class="col-xs-12 form-group">
                        <textarea ng-model="insertNote" maxlength="50" class="form-control asideinsertNote" placeholder="Note"></textarea>
                    </div>
                    <div class="col-xs-12 form-group">
                        <button ng-hide="(asideInsert.$invalid || (insertHour == null && insertExpense == null && insertNote == null))" class="btn btn-info" ng-click="insertReport()">Inserisci</button>
                        <button ng-show="(asideInsert.$invalid || (insertHour == null && insertExpense == null && insertNote == null))" class="btn btn-info" disabled="disabled">Inserisci</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="modalBg" ng-show="showInsert"></div>

        <div ng-repeat="day in detail.report">
            
        </div>

        <div class="reportList">
            <div class="row reportRow">
                <div class="col-xs-12 col-md-1 reportHeader">Giorno</div>
                <div class="col-xs-12 col-md-3 reportHeader">Dettaglio ore h</div>
                <div class="col-xs-12 col-md-1 reportHeader">Ore h</div>
                <div class="col-xs-12 col-md-3 reportHeader">Dettaglio spese €</div>
                <div class="col-xs-12 col-md-1 reportHeader">Spese €</div>
                <div class="col-xs-12 col-md-3 reportHeader reportHeaderLast">Note</div>
            </div>
            <div class="row reportRow" ng-class="{reportHolidayRow: !day.workday}" ng-repeat="day in detail.report | filter:iscurrentmonth:true">
                <span class="col-xs-12 col-md-1 reportColumn" ng-bind="day.date"></span>
                <span class="col-xs-12 col-md-3 reportColumn">
                    <span class="reportBadgeContainer" ng-repeat="houritem in day.hourscollection">
                        <img class="reportBadge" alt="" ng-src="https://img.shields.io/badge/{{houritem.reason}}-{{houritem.hourscount}}-blue.svg?style=flat" />
                        <span class="actionStripRight"><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Hour', houritem.id)"></i></span>
                    </span>
                </span>
                <span class="col-xs-12 col-md-1 reportColumn reportColumnNumeric" ng-bind="day.hours"></span>
                <span class="col-xs-12 col-md-3 reportColumn">
                    <span class="reportBadgeContainer" ng-repeat="expenseitem in day.expensescollection">
                        <img class="reportBadge" alt="" ng-src="https://img.shields.io/badge/{{expenseitem.completedescription}}-blue.svg?style=flat" />
                        <span class="actionStripRight"><i ng-show="expenseitem.reasonid == 1 || expenseitem.reasonid == 2" class="fa fa-info actionStripItem" ng-click="showExpenseInfo(expenseitem.id)"></i><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Expense', expenseitem.id)"></i></span>
                    </span>
                </span>
                <span class="col-xs-12 col-md-1 reportColumn reportColumnNumeric" ng-bind="day.expenses"></span>
                <span class="col-xs-12 col-md-3 reportColumn reportColumnLast">
                    <span class="noteContainer" ng-repeat="noteitem in day.notescollection">
                        <span class="actionStripLeft noteSection noteText" ng-bind="noteitem.note"></span>
                        <span class="actionStripRight noteSection"><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Note', noteitem.id)"></i></span>
                    </span>
                </span>
            </div>
        </div>   
        <div agm-footer></div>
    </div>
</div>