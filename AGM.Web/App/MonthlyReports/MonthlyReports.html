<a id="reportTop" class="reportTop"></a>
<div class="monthlyRep" ng-cloak>
    <div class="hidden-print mr_affixToolContainer" role="complementary" data-offset-top="235" bs-affix>
        <div class="container container-header">
            <i class="hidden-md hidden-lg fa fa-arrow-circle-o-left signAffix" ng-show="backToUsersVisible" ng-click="backToUsers()"></i>
            <i class="fa fa-bolt signAffix" ng-click="autocompleteReport()"></i>
            <i class="fa fa-plus-circle signAffix" ng-click="toggleAsideInsert()"></i>
        </div>
    </div>
    <h3 class="login-title login-control">Rapportini</h3>
    <!--

    <div class="monthlyRep-users" ng-hide="detailVisible">
        <div class="container-fluid">
            <div class="col-xs-12 col-md-6 form-group">
                <input class="form-control" type="text" ng-model="search.name" placeholder="Ricerca..." />
            </div>
            <div ng-repeat="user in users | filter:search:false | orderBy:'name':false as usersFiltered">
                <div class="col-xs-12 nameListLetterHead" ng-show="showLetter($index)" ng-bind="getFirstChar(user.name)"></div>
                <div class="col-xs-12 col-md-3">
                    <button class="btn btn-default btn-block nameListElement" ng-click="showDetail(user.id)">
                        <img ng-src="{{user.picture}}" alt="" style="height:48px;width:48px;" />
                        <div>
                            <span class="person-name" ng-bind="user.name"></span>
                            <span class="company-name" ng-bind="user.company"></span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        <div agm-footer></div>
    </div>

    -->
    <div class="monthlyRep-detail">
        <div>
            <i class="hidden-xs hidden-sm fa fa-arrow-circle-o-left sign" ng-show="backToUsersVisible" ng-click="backToUsers()"></i>&nbsp;<h4 class="detailUserName" ng-bind="detail.user.name"></h4>
        </div>
        <div class="col-xs-12 col-md-3 form-group">
            <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-calendar fa-fw"></i></span>
                <input id="monthPicker" type="text" class="form-control inputDatePicker" ng-model="selectedDate" ng-change="getUserDetail(selectedDate)"
                       data-min-view="1"
                       data-date-format="MMMM yyyy"
                       data-date-type="iso"
                       data-min-date="2014-01-01 00:00:00"
                       data-autoclose="1"
                       bs-datepicker
                       readonly>
            </div>
        </div>
        <div class="hidden-xs hidden-sm toolContainer">
            <i class="fa fa-bolt sign" ng-click="autocompleteReport()"></i>
            <i class="fa fa-plus-circle sign" ng-click="toggleAsideInsert()"></i>
        </div>
        <div class="clearfix"></div>
        
        <div class="asideRight" ng-show="showInsert">
            <div class="asideTitleContainer"><span class="asideTitle">Inserimento rapportino</span><i class="fa fa-times asideCloseIcon" ng-click="toggleAsideInsert()"></i></div>
            <div class="asideBodyContainer">
                <form name="asideInsert" novalidate>
                    <div class="col-xs-12 form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-calendar fa-fw"></i></span>
                            <input id="insertDayPicker" type="text" class="form-control inputDatePicker" ng-model="selectedInsertDate" ng-change="getUserDetail(selectedDate)"
                                   data-date-format="EEEE dd"
                                   data-date-type="iso"
                                   data-min-date="{{detail.minmonthdate}}"
                                   data-max-date="{{detail.maxmonthdate}}"
                                   data-autoclose="1"
                                   bs-datepicker
                                   readonly>
                        </div>
                    </div>
                    <div class="col-xs-12 form-group">
                        <div ng-class="{'has-error':!asideInsert.hour.$valid}">
                            <input name="hour" type="number" ng-model="insertHour" class="form-control" placeholder="Ore" min="0" max="24" step="any" />
                            <i ng-show="!asideInsert.hour.$valid" class="fa fa-exclamation-circle asideErrorInput" data-title="Il numero delle ore deve essere compreso tra 0 e 24" data-placement="right" data-trigger="click" bs-tooltip></i>
                        </div>
                        <button type="button" class="btn btn-default controlMinSeparated btnFill" ng-model="insertSelectedHourReason" ng-options="reason.id as reason.name for reason in detail.hourreasons" bs-select>
                            Action <span class="caret"></span>
                        </button>
                    </div>
                    <div class="col-xs-12 form-group">
                        <div class="input-group">
                            <span class="input-group-addon">
                                <span ng-show="insertSelectedExpenseReason == 1 || insertSelectedExpenseReason == 2">km</span>
                                <span ng-show="insertSelectedExpenseReason != 1 && insertSelectedExpenseReason != 2">€</span>
                            </span>
                            <input name="expense" type="number" ng-model="insertExpense" class="form-control" placeholder="Spese" min="0" max="9999" step="any" />
                        </div>
                        <i ng-show="!asideInsert.expense.$valid" class="fa fa-exclamation-circle asideErrorInput" data-title="Il numero deve essere compreso tra 0 e 9999" data-placement="right" data-trigger="click" bs-tooltip></i>
                        <button type="button" class="btn btn-default controlMinSeparated btnFill" ng-model="insertSelectedExpenseReason" data-html="1" ng-options="reason.id as reason.name for reason in detail.expensereasons" bs-select>
                            Action <span class="caret"></span>
                        </button>
                    </div>
                    <div class="col-xs-12 form-group">
                        <textarea ng-model="insertNote" maxlength="50" class="form-control asideinsertNote" placeholder="Note" ng-options="note as note for note in getRecurringNotes($viewValue)" bs-typeahead></textarea>
                    </div>
                    <div class="col-xs-12 form-group">
                        <button ng-hide="(asideInsert.$invalid || (insertHour == null && insertExpense == null && insertNote == null))" class="btn btn-info" ng-click="insertReport()">Inserisci</button>
                        <button ng-show="(asideInsert.$invalid || (insertHour == null && insertExpense == null && insertNote == null))" class="btn btn-info" disabled="disabled">Inserisci</button>
                    </div>
                </form>
            </div>
            <div class="loading loadingAbs" ng-show="loading_insert"></div>
        </div>
        
        <div class="modalBg" ng-show="showInsert"></div>

        <div class="reportList">
            <div class="row reportRow hidden-xs hidden-sm reportListHeader">
                <div class="col-xs-12 col-md-1 reportHeader">Giorno</div>
                <div class="col-xs-12 col-md-3 reportHeader">Dettaglio ore h</div>
                <div class="col-xs-12 col-md-1 reportHeader">Ore h</div>
                <div class="col-xs-12 col-md-3 reportHeader">Dettaglio spese €</div>
                <div class="col-xs-12 col-md-1 reportHeader">Spese €</div>
                <div class="col-xs-12 col-md-3 reportHeader">Note</div>
            </div>
            <div class="row reportRow" ng-class="{reportHolidayRow: !day.workday}" ng-repeat="day in detail.report | filter:iscurrentmonth:true">
                <span class="col-xs-12 col-md-1 reportColumn">
                    <span class="hidden-md hidden-lg dateRow" ng-class="{dateRowWorkDay: day.workday}">
                        <span class="cellHeaderColumnLeft" ng-bind="day.date"></span>
                        <span class="cellHeaderColumnRight"><i class="fa fa-eur umSign"></i><span ng-bind="day.expenses"></span></span>
                        <span class="cellHeaderColumnRight"><i class="fa fa-clock-o umSign">h</i><span ng-bind="day.hours"></span></span>
                    </span>
                    <span class="hidden-xs hidden-sm" ng-bind="day.dateshort"></span>
                </span>
                <span class="col-xs-12 col-md-3 reportColumn">
                    <span class="reportBadgeContainer" ng-repeat="houritem in day.hourscollection">
                        <span class="visible-xs-inline-block visible-sm-inline-block actionStripLeft"><i class="fa fa-clock-o prefixSign">h</i></span>
                        <img class="reportBadge" alt="" ng-src="https://img.shields.io/badge/{{houritem.reason}}-{{houritem.hourscountstring}}-blue.svg?style=flat" />
                        <span class="actionStripRight"><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Hour', houritem.id)"></i></span>
                    </span>
                </span>
                <span class="col-xs-12 col-md-1 hidden-xs hidden-sm reportColumn reportColumnNumeric"><i class="visible-xs-inline-block visible-sm-inline-block fa fa-clock-o umSign">h</i><span ng-bind="day.hours"></span></span>
                <span class="col-xs-12 col-md-3 reportColumn">
                    <span class="reportBadgeContainer" ng-repeat="expenseitem in day.expensescollection">
                        <span class="visible-xs-inline-block visible-sm-inline-block actionStripLeft"><i class="fa fa-eur prefixSign"></i></span>
                        <img class="reportBadge" alt="" ng-src="https://img.shields.io/badge/{{expenseitem.completedescription}}-blue.svg?style=flat" />
                        <span class="actionStripRight"><i ng-show="expenseitem.reasonid == 1 || expenseitem.reasonid == 2" class="fa fa-info actionStripItem" ng-click="showExpenseInfo(expenseitem.id)"></i><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Expense', expenseitem.id)"></i></span>
                    </span>
                </span>
                <span class="col-xs-12 col-md-1 hidden-xs hidden-sm reportColumn reportColumnNumeric"><i class="visible-xs-inline-block visible-sm-inline-block fa fa-eur umSign"></i><span ng-bind="day.expenses"></span></span>
                <span class="col-xs-12 col-md-3 reportColumn">
                    <span class="noteContainer" ng-repeat="noteitem in day.notescollection">
                        <span class="actionStripLeft noteSection noteText"><i class="visible-xs-inline-block visible-sm-inline-block fa fa-pencil-square-o prefixSignLeft"></i><span ng-bind="noteitem.note"></span></span>
                        <span class="actionStripRight noteSection"><i class="fa fa-trash-o actionStripItem" ng-click="removeReport('Note', noteitem.id)"></i></span>
                    </span>
                </span>
            </div>
        </div>
        
        <div class="reportSummary">
            <span class="reportSummaryRow">totale ore: <b><span ng-bind="detail.totalhours"></span>h(<span ng-bind="detail.totaldays"></span> gg)</b></span>
            <span class="reportSummaryRow">ordinarie: <span ng-bind="detail.totalordinaryhours"></span>h(<span ng-bind="detail.totalordinarydays"></span> gg)</span>
            <span class="reportSummaryRow" ng-show="detail.totalholidays != '0,00'">ferie: <span ng-bind="detail.totalholidays"></span>h(<span ng-bind="detail.totalholidaysdays"></span> gg)</span>
            <br />
            <span class="reportSummaryRow">totale spese: <b><span ng-bind="detail.totalexpenses"></span>€</b></span>
        </div>
          
        <div agm-footer></div>
    </div>
    <div class="loading" ng-show="loading_detail"></div>
</div>